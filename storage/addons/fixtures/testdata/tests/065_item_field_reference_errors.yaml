- name: WHEN loader cannot find reference record loader MUST fail with error
  method: GET
  path: /gonkex/process
  request: |
     names: ["file1"]
     fs:
        file1: |
           tables:
             table1:
               - $name: ref1
                 f1: value1
                 f2: value2
             table3:
               - f2: $wrongref.f1
  response: 
    200: |-
       error: processing table 'table3': undefined reference 'wrongref' in '$wrongref.f1'

- name: WHEN loader cannot find reference field loader MUST fail with error
  method: GET
  path: /gonkex/process
  request: |
     names: ["file1"]
     fs:
        file1: |
           tables:
             table1:
               - $name: ref1
                 f1: value1
                 f2: value2
             table3:
               - f2: $ref1.wrongfield
  response: 
    200: |-
       error: processing table 'table3': undefined reference field 'wrongfield'

- name: WHEN several items has same $ref name loader MUST fail with error
  method: GET
  path: /gonkex/process
  request: |
     names: ["file1"]
     fs:
        file1: |
           tables:
             table1:
               - $name: ref1
                 f1: value1
                 f2: value2
               - $name: ref1
                 f1: value2
                 f2: value2
  response: 
    200: |-
       error: processing table 'table1': duplicating ref name ref1

- name: WHEN reference path does not have entry name loader MUST fail with error
  method: GET
  path: /gonkex/process
  request: |
     names: ["file1"]
     fs:
        file1: |
           tables:
             table1:
               - $name: ref1
                 f1: value1
                 f2: value2
             table3:
               - f2: $.f1
  response: 
    200: |-
       error: processing table 'table3': invalid reference '$.f1', correct form is '$refName.field'

- name: WHEN reference path has only one segment loader MUST fail with error
  method: GET
  path: /gonkex/process
  request: |
     names: ["file1"]
     fs:
        file1: |
           tables:
             table1:
               - $name: ref1
                 f1: value1
                 f2: value2
             table3:
               - f2: $ref1
  response: 
    200: |-
       error: processing table 'table3': invalid reference '$ref1', correct form is '$refName.field'
