- name: strategy template example from documentation
  method: POST
  path: /test/case
  query: ?some_value=from_query
  headers:
    SomeHeader: from_header
    OtherHeader: other_value
  request: >
    {
      "data": "from_body"
    }
  response:
    200: >
      {
        "value-from-host": "$matchRegexp(^127.0.0.1:\\d+$)",
        "value-from-header": "from_header",
        "value-from-query": "from_query",
        "data-from-body": "from_body",
        "result": 1
      }
  responseHeaders:
    200:
      Header1: Value1
      Header2: Value2
  mocks:
    someservice:
      strategy: template
      headers:
        Header1: Value1
        Header2: Value2
      body: |
        {
          "value-from-host": "{{ .request.Header "Host" }}",
          "value-from-header": "{{ .request.Header "SomeHeader" }}",
          "value-from-query": "{{ .request.Query "some_value" }}",
          "data-from-body": "{{ .request.Json.data }}",
          "result": 1
        }
      statusCode: 200

- name: WHEN strategy requires Json body, but body is plain strategy MUST fail with error
  method: POST
  path: /test/case
  request: "plain content"
  response:
    200: ""
  mocks:
    someservice:
      strategy: template
      body: |
        {
          "data-from-body": "{{ .request.Json.data }}"
        }
      statusCode: 200
  meta:
    expected: |
       1) mock 'someservice': strategy 'template': template: :2:32: executing "" at <.request.Json.data>: error calling Json: parse request as json: invalid character 'p' looking for beginning of value, request was...
